<!DOCTYPE html>
<html>
<body>
<style>
iframe {
  opacity: 0;
}
</style>
<p>Migrating...</p>
<iframe id="iframe" src="https://wy-lang.org/__migrate__"></iframe>
<script>
function redirect() {
  window.location = '/'
}
if (localStorage.getItem('wenyan-ide-migrated') === 'true')
  redirect()

const iframe = document.getElementById('iframe')

window.addEventListener('message', (e) => {
  const { key, value } = e.data
  if (key === 'wenyang-ide') {
    const obj = JSON.parse(value)
    let set = true
    if (localStorage.getItem('wenyan-ide-files'))
      set = confirm('Data already exists. Do you want to override?')
    
    if (set) {
      localStorage.setItem('wenyan-ide-files', JSON.stringify(obj.files))
      localStorage.setItem('wenyan-ide-config', JSON.stringify(obj.config))
    }
    localStorage.setItem('wenyan-ide-migrated', 'true')
    
    redirect()
  }
}, false);

iframe.onload = () => {
  iframe.contentWindow.postMessage({ key: 'wenyang-ide' }, '*')
}
</script>
</body>
</html>